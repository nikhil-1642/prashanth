<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Order Fish Pickles</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f9fafc;
      color: #2c3e50;
      margin: 0;
      padding: 40px 20px;
      line-height: 1.6;
    }
    h1 {
      font-weight: 700;
      font-size: 2.6rem;
      text-align: center;
      margin-bottom: 2rem;
      color: #34495e;
    }
    form#orderForm {
      max-width: 1200px;
      margin: 0 auto;
      background: #ffffff;
      padding: 30px 40px;
      border-radius: 15px;
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.08);
    }
    form label {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 1rem;
      display: block;
    }
    .name-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 30px;
    }
    .name-grid > div {
      background: #fefefe;
      border-radius: 12px;
      padding: 20px 15px;
      text-align: center;
      box-shadow: 0 8px 16px rgba(52, 73, 94, 0.1);
    }
    .name-grid img {
      width: 100%;
      max-width: 230px;
      height: 160px;
      border-radius: 12px;
      object-fit: cover;
      margin-bottom: 15px;
    }
    input[type="number"] {
      width: 90px;
      padding: 12px 14px;
      border-radius: 10px;
      border: 1.8px solid #bdc3c7;
      font-size: 1.15rem;
      text-align: center;
    }
    .cost {
      margin-top: 10px;
      font-weight: 700;
      font-size: 1.1rem;
      color: #4e54c8;
    }
    .total-cost {
      margin-top: 30px;
      font-size: 1.6rem;
      font-weight: 700;
      text-align: right;
    }
    button[type="submit"], .buyBtn {
      margin-top: 15px;
      background: linear-gradient(135deg, #4e54c8 0%, #8f94fb 100%);
      color: #fff;
      border: none;
      padding: 10px 20px;
      border-radius: 12px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 8px 15px rgba(78, 84, 200, 0.4);
      transition: background 0.3s ease;
    }
    button:hover {
      background: linear-gradient(135deg, #3a3ebd 0%, #737bf9 100%);
    }
    a {
      display: inline-block;
      margin: 10px 10px 20px 0;
      text-decoration: none;
      font-weight: 600;
      font-size: 1.1rem;
      color: #4e54c8;
      background-color: #e0e7ff;
      padding: 12px 24px;
      border-radius: 10px;
    }
    @media (max-width: 600px) {
      .name-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>

<a href="/your_orders.html">üì¶ Your Orders</a>
<a href="#" id="logoutBtn">üè† Logout</a>
<a href="/edit_profile_user">‚úèÔ∏è Edit Profile</a>

<h1>Order Fish Pickles</h1>

<form id="orderForm">
  <label>Select Fish Pickles:</label>
   <div class="name-grid">
      <!-- Item 1 -->
      <div>
        <p>
          <img src="https://tiimg.tistatic.com/fp/1/004/141/seer-fish-pickles-176.jpg" alt="Seer Fish Pickle" />
          Seer Fish Pickle
        </p>
        <input type="number" id="qty1" name="qty1" placeholder="Qty" min="1" oninput="updateCost()" />
        <p class="cost" id="cost1">Cost: ‚Çπ0</p>
        <button class="buyBtn" data-id="1" type="button">üõí Buy Now</button>
      </div>

      <!-- Item 2 -->
      <div>
        <p>
          <img src="https://tiimg.tistatic.com/fp/1/008/598/kalans-food-fish-pickle-067.jpg" alt="Kalans Fish Pickle" />
          Kalans Fish Pickle
        </p>
        <input type="number" id="qty2" name="qty2" placeholder="Qty" min="1" oninput="updateCost()" />
        <p class="cost" id="cost2">Cost: ‚Çπ0</p>
        <button class="buyBtn" data-id="2" type="button">üõí Buy Now</button>
      </div>

      <!-- Item 3 -->
      <div>
        <p>
          <img src="https://www.tastynibbles.in/cdn/shop/products/fishpickle1_1080x.jpg?v=1672901660" alt="Tasty Nibbles Fish Pickle" />
          Tasty Nibbles Fish Pickle
        </p>
        <input type="number" id="qty3" name="qty3" placeholder="Qty" min="1" oninput="updateCost()" />
        <p class="cost" id="cost3">Cost: ‚Çπ0</p>
        <button class="buyBtn" data-id="3" type="button">üõí Buy Now</button>
      </div>

      <!-- Item 4 -->
      <div>
        <p>
          <img src="https://purelysouth.com/cdn/shop/files/PurelySouthNethilifishpickle.jpg?v=1700451112&width=533" alt="Purely South Nethili Fish Pickle" />
          Purely South Nethili Fish Pickle
        </p>
        <input type="number" id="qty4" name="qty4" placeholder="Qty" min="1" oninput="updateCost()" />
        <p class="cost" id="cost4">Cost: ‚Çπ0</p>
        <button class="buyBtn" data-id="4" type="button">üõí Buy Now</button>
      </div>

      <!-- Item 5 -->
      <div>
        <p>
          <img src="https://images.jdmagicbox.com/quickquotes/images_main/fish-pickle-2m4n693r.png" alt="JD MagicBox Fish Pickle" />
          JD MagicBox Fish Pickle
        </p>
        <input type="number" id="qty5" name="qty5" placeholder="Qty" min="1" oninput="updateCost()" />
        <p class="cost" id="cost5">Cost: ‚Çπ0</p>
        <button class="buyBtn" data-id="5" type="button">üõí Buy Now</button>
      </div>

      <!-- Item 6 -->
      <div>
        <p>
          <img src="https://m.media-amazon.com/images/I/71uJdEKC1uL._AC_UF1000,1000_QL80_.jpg" alt="Home Style Fish Pickle" />
          Home Style Fish Pickle
        </p>
        <input type="number" id="qty6" name="qty6" placeholder="Qty" min="1" oninput="updateCost()" />
        <p class="cost" id="cost6">Cost: ‚Çπ0</p>
        <button class="buyBtn" data-id="6" type="button">üõí Buy Now</button>
      </div>

      <!-- Item 7 -->
      <div>
        <p>
          <img src="https://5.imimg.com/data5/SELLER/Default/2021/10/CF/KH/OZ/142161234/prawn-pickle.jpg" alt="Prawn Fish Pickle" />
          Prawn Fish Pickle
        </p>
        <input type="number" id="qty7" name="qty7" placeholder="Qty" min="1" oninput="updateCost()" />
        <p class="cost" id="cost7">Cost: ‚Çπ0</p>
        <button class="buyBtn" data-id="7" type="button">üõí Buy Now</button>
      </div>

      <!-- Item 8 -->
      <div>
        <p>
          <img src="https://www.bigbasket.com/media/uploads/p/l/40075594_1-mothers-recipe-fish-pickle.jpg" alt="Mother‚Äôs Recipe Fish Pickle" />
          Mother‚Äôs Recipe Fish Pickle
        </p>
        <input type="number" id="qty8" name="qty8" placeholder="Qty" min="1" oninput="updateCost()" />
        <p class="cost" id="cost8">Cost: ‚Çπ0</p>
        <button class="buyBtn" data-id="8" type="button">üõí Buy Now</button>
      </div>

      <!-- Item 9 -->
      <div>
        <p>
          <img src="https://www.jiomart.com/images/product/original/rvcdzzkpik/sapna-s-fish-pickle-250-g-product-images-orvcdzzkpik-p593754128-0-202304281432.jpg" alt="Sapna Fish Pickle" />
          Sapna Fish Pickle
        </p>
        <input type="number" id="qty9" name="qty9" placeholder="Qty" min="1" oninput="updateCost()" />
        <p class="cost" id="cost9">Cost: ‚Çπ0</p>
        <button class="buyBtn" data-id="9" type="button">üõí Buy Now</button>
      </div>

      <!-- Item 10 -->
      <div>
        <p>
          <img src="https://cdn.shopify.com/s/files/1/0281/2725/6084/products/IMG_20221204_110759.jpg?v=1670142034" alt="Karimeen Fish Pickle" />
          Karimeen Fish Pickle
        </p>
        <input type="number" id="qty10" name="qty10" placeholder="Qty" min="1" oninput="updateCost()" />
        <p class="cost" id="cost10">Cost: ‚Çπ0</p>
        <button class="buyBtn" data-id="10" type="button">üõí Buy Now</button>
      </div>
    </div>

  <p class="total-cost" id="totalCost">Total Cost: ‚Çπ0</p>

  <input type="hidden" id="pickles" name="pickles" />
  <input type="hidden" id="total" name="total" />
  <button type="submit">üõí Add All to Cart</button>
</form>

<a href="/cart.html">üõí Go to Cart</a>

<script>
  const prices = [400, 390, 600, 420, 390, 450, 650, 400, 380, 400];
  const pickleNames = [
    "Seer Fish Pickle",
    "Kalans Fish Pickle",
    "Tasty Nibbles Fish Pickle",
    "Purely South Nethili Fish Pickle",
    "JD MagicBox Fish Pickle",
    "Home Style Fish Pickle",
    "Prawn Fish Pickle",
    "Mother‚Äôs Recipe Fish Pickle",
    "Sapna Fish Pickle",
    "Karimeen Fish Pickle"
  ];

  function updateCost() {
    let total = 0;
    let picklesList = [];

    for (let i = 1; i <= 10; i++) {
      const qtyInput = document.getElementById("qty" + i);
      if (!qtyInput) continue;

      const qty = parseInt(qtyInput.value) || 0;
      const cost = qty * prices[i - 1];
      const costElem = document.getElementById("cost" + i);
      if (costElem) costElem.textContent = "Cost: ‚Çπ" + cost;

      total += cost;

      if (qty > 0) {
        picklesList.push(`${qty} x ${pickleNames[i - 1]}`);
      }
    }

    document.getElementById("totalCost").textContent = "Total Cost: ‚Çπ" + total;
    document.getElementById("pickles").value = picklesList.join(", ");
    document.getElementById("total").value = total;
  }

  document.getElementById("orderForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    updateCost();

    let cartItems = [];
    for (let i = 1; i <= 10; i++) {
      const qty = parseInt(document.getElementById("qty" + i)?.value) || 0;
      if (qty > 0) {
        cartItems.push({
          pickle_name: pickleNames[i - 1],
          quantity: qty,
          cost: qty * prices[i - 1]
        });
      }
    }

    if (cartItems.length === 0) {
      alert("Please select at least one pickle.");
      return;
    }

    try {
  const res = await fetch("/add_to_cart", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ items: cartItems })
  });

  const result = await res.json();
  if (result.success) {
    alert("Items added to cart!");
  } else {
    alert("Failed to add: " + (result.message || "Unknown error"));
  }
} catch (err) {
  alert("Error: " + err.message);
}

  });

  // Buy now for each item
  document.querySelectorAll(".buyBtn").forEach(btn => {
    btn.addEventListener("click", async () => {
      const id = parseInt(btn.dataset.id);
      const qtyInput = document.getElementById("qty" + id);
      const qty = parseInt(qtyInput?.value) || 0;

      if (qty <= 0) {
        alert("Please enter quantity to buy.");
        return;
      }

      const item = {
        pickle_name: pickleNames[id - 1],
        quantity: qty,
        cost: qty * prices[id - 1]
      };

      try {
        const res = await fetch("/buy_now", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(item)
        });

        const result = await res.json();
        if (result.success) {
          alert("Purchase successful!");
        } else {
          alert("Failed: " + (result.message || "Unknown error"));
        }
      } catch (err) {
        alert("Error: " + err.message);
      }
    });
  });

  // Logout
  document.getElementById("logoutBtn").addEventListener("click", async (e) => {
    e.preventDefault();
    try {
      const res = await fetch("/logout", {
        method: "POST",
        credentials: "same-origin"
      });
      const result = await res.json();
      if (result.success) {
        alert("You have been logged out.");
        window.location.href = "/index.html";
      } else {
        alert("Logout failed.");
      }
    } catch (err) {
      alert("Error: " + err.message);
    }
  });
</script>
</body>
</html>
